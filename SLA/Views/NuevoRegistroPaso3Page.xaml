<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:SLA.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="SLA.Views.NuevoRegistroPaso3Page"
             BackgroundColor="#1a1c1e"
             Title="Confirmación">

    <!--<ContentPage.BindingContext>
        <vm:NuevoRegistroPaso3ViewModel />
    </ContentPage.BindingContext>-->

    <Grid RowDefinitions="Auto, *, Auto" Padding="25" RowSpacing="15">

        <Grid Grid.Row="0" ColumnDefinitions="*, *, *" ColumnSpacing="10" HeightRequest="10">
            <Border Grid.Column="0" BackgroundColor="#2E7D32" StrokeShape="RoundRectangle 5" />
            <Border Grid.Column="1" BackgroundColor="#2E7D32" StrokeShape="RoundRectangle 5" />
            <Border Grid.Column="2" BackgroundColor="#A8C7FA" StrokeShape="RoundRectangle 5" />
        </Grid>

        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="20">
                <Label
                    Text="Resumen de carga"
                    TextColor="#a8c7fa"
                    CharacterSpacing="1"
                    FontSize="18"
                    FontAttributes="Bold" />

                <Border BackgroundColor="#2c2f33" Stroke="#454b52" Padding="15" StrokeShape="RoundRectangle 8">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Datos del receptor" TextColor="#8e9196" FontSize="10" FontAttributes="Bold" />
                        <Label Text="{Binding NombreReceptor}" TextColor="White" FontSize="16" FontAttributes="Bold" />
                        <Label Text="{Binding GradoUnidadReceptor}" TextColor="#A8C7FA" FontSize="12" />
                        <Label Text="{Binding DniReceptor, StringFormat='DNI/LEGAJO: {0}'}" TextColor="#8e9196" FontSize="11" />
                    </VerticalStackLayout>
                </Border>

                <Border BackgroundColor="#2C2F33" Stroke="#454b52" Padding="15"  StrokeShape="RoundRectangle 8">
                    <!-- DATOS GENERALES -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="Misión y origen" TextColor="#8e9196" CharacterSpacing="1" FontSize="10" FontAttributes="Bold" />
                        <Label Text="{Binding ResumenMision}" TextColor="White" FontSize="14"/>
                        <BoxView HeightRequest="1" Color="#3b3f44" Margin="0,5"/>

                        <Label Text="{Binding ResumenGeneral}" TextColor="#8e9196" FontSize="12"/>
                    </VerticalStackLayout>
                </Border>

                <VerticalStackLayout Spacing="10">
                    <!-- DETALLE -->
                    <Label Text="Detalle" 
                           TextColor="#8e9196"
                           CharacterSpacing="1"
                           FontSize="10"
                           FontAttributes="Bold" />

                    <CollectionView ItemsSource="{Binding Items}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="12"
                                        Margin="0,0,0,5"
                                        BackgroundColor="#24272b"
                                        Stroke="#3b3f44"
                                        StrokeShape="RoundRectangle 4">
                                    <Label Text="{Binding Resumen}" 
                                           TextColor="#a8c7fa"
                                           FontSize="13"
                                           FontAttributes="Bold"/>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>

                <!-- FIRMA -->
                <Border BackgroundColor="#2C2F33" Stroke="#454b52" Padding="15" StrokeShape="RoundRectangle 8">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Firma del receptor" TextColor="#8e9196" FontSize="10" FontAttributes="Bold" />

                        <Border BackgroundColor="White" StrokeShape="RoundRectangle 4" StrokeThickness="0">
                            <toolkit:DrawingView
                                x:Name="FirmaDrawingView"
                                HeightRequest="180"
                                LineColor="Black"
                                LineWidth="3" />
                        </Border>

                        <Button Text="Limpiar firma"
                                Clicked="OnLimpiarFirmaClicked"
                                BackgroundColor="Transparent"
                                TextColor="#A8C7FA"
                                FontSize="11"
                                HorizontalOptions="End" />
                    </VerticalStackLayout>
                </Border>

                <Border BackgroundColor="#1a1c1e" 
                        Stroke="#454b52" 
                        StrokeDashArray="4,2"
                        Padding="15" 
                        StrokeShape="RoundRectangle 8">
                    <VerticalStackLayout Spacing="5" HorizontalOptions="Center">
                        <Label Text="Responsable" 
                               TextColor="#8e9196" 
                               FontSize="10" 
                               FontAttributes="Bold" 
                               HorizontalOptions="Center"/>
                        <Label Text="{Binding Operador}" 
                               TextColor="White" 
                               FontSize="16" 
                               FontAttributes="Bold" 
                               HorizontalOptions="Center"/>

                        <BoxView HeightRequest="1" Color="#454B52" WidthRequest="150" Margin="0,10,0,0"/>

                        <Label Text="Identidad confirmada" 
                               TextColor="#2e7d32" 
                               FontSize="9" 
                               FontAttributes="Bold" 
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>
        </ScrollView>

        <!-- CONFIRMAR -->
        <VerticalStackLayout Grid.Row="2" Spacing="10" Margin="0,10,0,0">

            <Button Text="CONFIRMAR Y TRANSMITIR" 
                    Clicked="OnConfirmarClicked"
                    BackgroundColor="#2E7D32" TextColor="White" FontAttributes="Bold"
                    HeightRequest="60" CornerRadius="8" />

            <Grid ColumnDefinitions="*, *" ColumnSpacing="10">
                <Button Grid.Column="0"
                        Text="Volver al paso anterior" 
                        Command="{Binding VolverCommand}" 
                        BackgroundColor="#2C2F33" TextColor="#A8C7FA" 
                        BorderColor="#A8C7FA" BorderWidth="1"
                        FontSize="12" FontAttributes="Bold" HeightRequest="45" />

                <Button Grid.Column="1"
                        Text="Cancelar" 
                        Command="{Binding CancelarCommand}"
                        BackgroundColor="Transparent" TextColor="#C62828" 
                        FontSize="12" FontAttributes="Bold" HeightRequest="45" />
            </Grid>

        </VerticalStackLayout>
    </Grid>
</ContentPage>
